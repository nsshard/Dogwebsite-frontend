{"ast":null,"code":"'use strict';\n\nconst KillCursor = require('../connection/commands').KillCursor;\n\nconst MongoError = require('../error').MongoError;\n\nconst MongoNetworkError = require('../error').MongoNetworkError;\n\nconst collectionNamespace = require('./shared').collectionNamespace;\n\nconst maxWireVersion = require('../utils').maxWireVersion;\n\nconst command = require('./command');\n\nfunction killCursors(server, ns, cursorState, callback) {\n  callback = typeof callback === 'function' ? callback : () => {};\n  const cursorId = cursorState.cursorId;\n\n  if (maxWireVersion(server) < 4) {\n    const bson = server.s.bson;\n    const pool = server.s.pool;\n    const killCursor = new KillCursor(bson, ns, [cursorId]);\n    const options = {\n      immediateRelease: true,\n      noResponse: true\n    };\n\n    if (typeof cursorState.session === 'object') {\n      options.session = cursorState.session;\n    }\n\n    if (pool && pool.isConnected()) {\n      try {\n        pool.write(killCursor, options, callback);\n      } catch (err) {\n        if (typeof callback === 'function') {\n          callback(err, null);\n        } else {\n          console.warn(err);\n        }\n      }\n    }\n\n    return;\n  }\n\n  const killCursorCmd = {\n    killCursors: collectionNamespace(ns),\n    cursors: [cursorId]\n  };\n  const options = {};\n  if (typeof cursorState.session === 'object') options.session = cursorState.session;\n  command(server, ns, killCursorCmd, options, (err, result) => {\n    if (err) {\n      return callback(err);\n    }\n\n    const response = result.message;\n\n    if (response.cursorNotFound) {\n      return callback(new MongoNetworkError('cursor killed or timed out'), null);\n    }\n\n    if (!Array.isArray(response.documents) || response.documents.length === 0) {\n      return callback(new MongoError(`invalid killCursors result returned for cursor id ${cursorId}`));\n    }\n\n    callback(null, response.documents[0]);\n  });\n}\n\nmodule.exports = killCursors;","map":{"version":3,"names":["KillCursor","require","MongoError","MongoNetworkError","collectionNamespace","maxWireVersion","command","killCursors","server","ns","cursorState","callback","cursorId","bson","s","pool","killCursor","options","immediateRelease","noResponse","session","isConnected","write","err","console","warn","killCursorCmd","cursors","result","response","message","cursorNotFound","Array","isArray","documents","length","module","exports"],"sources":["C:/Users/Administrator/Desktop/webAPI work/web/dog-website/node_modules/koa-mongo/node_modules/mongodb/lib/core/wireprotocol/kill_cursors.js"],"sourcesContent":["'use strict';\n\nconst KillCursor = require('../connection/commands').KillCursor;\nconst MongoError = require('../error').MongoError;\nconst MongoNetworkError = require('../error').MongoNetworkError;\nconst collectionNamespace = require('./shared').collectionNamespace;\nconst maxWireVersion = require('../utils').maxWireVersion;\nconst command = require('./command');\n\nfunction killCursors(server, ns, cursorState, callback) {\n  callback = typeof callback === 'function' ? callback : () => {};\n  const cursorId = cursorState.cursorId;\n\n  if (maxWireVersion(server) < 4) {\n    const bson = server.s.bson;\n    const pool = server.s.pool;\n    const killCursor = new KillCursor(bson, ns, [cursorId]);\n    const options = {\n      immediateRelease: true,\n      noResponse: true\n    };\n\n    if (typeof cursorState.session === 'object') {\n      options.session = cursorState.session;\n    }\n\n    if (pool && pool.isConnected()) {\n      try {\n        pool.write(killCursor, options, callback);\n      } catch (err) {\n        if (typeof callback === 'function') {\n          callback(err, null);\n        } else {\n          console.warn(err);\n        }\n      }\n    }\n\n    return;\n  }\n\n  const killCursorCmd = {\n    killCursors: collectionNamespace(ns),\n    cursors: [cursorId]\n  };\n\n  const options = {};\n  if (typeof cursorState.session === 'object') options.session = cursorState.session;\n\n  command(server, ns, killCursorCmd, options, (err, result) => {\n    if (err) {\n      return callback(err);\n    }\n\n    const response = result.message;\n    if (response.cursorNotFound) {\n      return callback(new MongoNetworkError('cursor killed or timed out'), null);\n    }\n\n    if (!Array.isArray(response.documents) || response.documents.length === 0) {\n      return callback(\n        new MongoError(`invalid killCursors result returned for cursor id ${cursorId}`)\n      );\n    }\n\n    callback(null, response.documents[0]);\n  });\n}\n\nmodule.exports = killCursors;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}