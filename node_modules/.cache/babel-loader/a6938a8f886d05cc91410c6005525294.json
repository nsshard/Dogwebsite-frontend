{"ast":null,"code":"'use strict';\n\nconst ReadPreference = require('../topologies/read_preference');\n\nconst MongoError = require('../error').MongoError;\n\nconst ServerType = require('../sdam/common').ServerType;\n\nconst TopologyDescription = require('../sdam/topology_description').TopologyDescription;\n\nconst MESSAGE_HEADER_SIZE = 16;\nconst COMPRESSION_DETAILS_SIZE = 9; // originalOpcode + uncompressedSize, compressorID\n// OPCODE Numbers\n// Defined at https://docs.mongodb.com/manual/reference/mongodb-wire-protocol/#request-opcodes\n\nvar opcodes = {\n  OP_REPLY: 1,\n  OP_UPDATE: 2001,\n  OP_INSERT: 2002,\n  OP_QUERY: 2004,\n  OP_GETMORE: 2005,\n  OP_DELETE: 2006,\n  OP_KILL_CURSORS: 2007,\n  OP_COMPRESSED: 2012,\n  OP_MSG: 2013\n};\n\nvar getReadPreference = function (cmd, options) {\n  // Default to command version of the readPreference\n  var readPreference = cmd.readPreference || new ReadPreference('primary'); // If we have an option readPreference override the command one\n\n  if (options.readPreference) {\n    readPreference = options.readPreference;\n  }\n\n  if (typeof readPreference === 'string') {\n    readPreference = new ReadPreference(readPreference);\n  }\n\n  if (!(readPreference instanceof ReadPreference)) {\n    throw new MongoError('read preference must be a ReadPreference instance');\n  }\n\n  return readPreference;\n}; // Parses the header of a wire protocol message\n\n\nvar parseHeader = function (message) {\n  return {\n    length: message.readInt32LE(0),\n    requestId: message.readInt32LE(4),\n    responseTo: message.readInt32LE(8),\n    opCode: message.readInt32LE(12)\n  };\n};\n\nfunction applyCommonQueryOptions(queryOptions, options) {\n  Object.assign(queryOptions, {\n    raw: typeof options.raw === 'boolean' ? options.raw : false,\n    promoteLongs: typeof options.promoteLongs === 'boolean' ? options.promoteLongs : true,\n    promoteValues: typeof options.promoteValues === 'boolean' ? options.promoteValues : true,\n    promoteBuffers: typeof options.promoteBuffers === 'boolean' ? options.promoteBuffers : false,\n    monitoring: typeof options.monitoring === 'boolean' ? options.monitoring : false,\n    fullResult: typeof options.fullResult === 'boolean' ? options.fullResult : false\n  });\n\n  if (typeof options.socketTimeout === 'number') {\n    queryOptions.socketTimeout = options.socketTimeout;\n  }\n\n  if (options.session) {\n    queryOptions.session = options.session;\n  }\n\n  if (typeof options.documentsReturnedIn === 'string') {\n    queryOptions.documentsReturnedIn = options.documentsReturnedIn;\n  }\n\n  return queryOptions;\n}\n\nfunction isSharded(topologyOrServer) {\n  if (topologyOrServer.type === 'mongos') return true;\n\n  if (topologyOrServer.description && topologyOrServer.description.type === ServerType.Mongos) {\n    return true;\n  } // NOTE: This is incredibly inefficient, and should be removed once command construction\n  //       happens based on `Server` not `Topology`.\n\n\n  if (topologyOrServer.description && topologyOrServer.description instanceof TopologyDescription) {\n    const servers = Array.from(topologyOrServer.description.servers.values());\n    return servers.some(server => server.type === ServerType.Mongos);\n  }\n\n  return false;\n}\n\nfunction databaseNamespace(ns) {\n  return ns.split('.')[0];\n}\n\nfunction collectionNamespace(ns) {\n  return ns.split('.').slice(1).join('.');\n}\n\nmodule.exports = {\n  getReadPreference,\n  MESSAGE_HEADER_SIZE,\n  COMPRESSION_DETAILS_SIZE,\n  opcodes,\n  parseHeader,\n  applyCommonQueryOptions,\n  isSharded,\n  databaseNamespace,\n  collectionNamespace\n};","map":{"version":3,"names":["ReadPreference","require","MongoError","ServerType","TopologyDescription","MESSAGE_HEADER_SIZE","COMPRESSION_DETAILS_SIZE","opcodes","OP_REPLY","OP_UPDATE","OP_INSERT","OP_QUERY","OP_GETMORE","OP_DELETE","OP_KILL_CURSORS","OP_COMPRESSED","OP_MSG","getReadPreference","cmd","options","readPreference","parseHeader","message","length","readInt32LE","requestId","responseTo","opCode","applyCommonQueryOptions","queryOptions","Object","assign","raw","promoteLongs","promoteValues","promoteBuffers","monitoring","fullResult","socketTimeout","session","documentsReturnedIn","isSharded","topologyOrServer","type","description","Mongos","servers","Array","from","values","some","server","databaseNamespace","ns","split","collectionNamespace","slice","join","module","exports"],"sources":["C:/Users/Administrator/Desktop/webAPI work/web/dog-website/node_modules/koa-mongo/node_modules/mongodb/lib/core/wireprotocol/shared.js"],"sourcesContent":["'use strict';\n\nconst ReadPreference = require('../topologies/read_preference');\nconst MongoError = require('../error').MongoError;\nconst ServerType = require('../sdam/common').ServerType;\nconst TopologyDescription = require('../sdam/topology_description').TopologyDescription;\n\nconst MESSAGE_HEADER_SIZE = 16;\nconst COMPRESSION_DETAILS_SIZE = 9; // originalOpcode + uncompressedSize, compressorID\n\n// OPCODE Numbers\n// Defined at https://docs.mongodb.com/manual/reference/mongodb-wire-protocol/#request-opcodes\nvar opcodes = {\n  OP_REPLY: 1,\n  OP_UPDATE: 2001,\n  OP_INSERT: 2002,\n  OP_QUERY: 2004,\n  OP_GETMORE: 2005,\n  OP_DELETE: 2006,\n  OP_KILL_CURSORS: 2007,\n  OP_COMPRESSED: 2012,\n  OP_MSG: 2013\n};\n\nvar getReadPreference = function(cmd, options) {\n  // Default to command version of the readPreference\n  var readPreference = cmd.readPreference || new ReadPreference('primary');\n  // If we have an option readPreference override the command one\n  if (options.readPreference) {\n    readPreference = options.readPreference;\n  }\n\n  if (typeof readPreference === 'string') {\n    readPreference = new ReadPreference(readPreference);\n  }\n\n  if (!(readPreference instanceof ReadPreference)) {\n    throw new MongoError('read preference must be a ReadPreference instance');\n  }\n\n  return readPreference;\n};\n\n// Parses the header of a wire protocol message\nvar parseHeader = function(message) {\n  return {\n    length: message.readInt32LE(0),\n    requestId: message.readInt32LE(4),\n    responseTo: message.readInt32LE(8),\n    opCode: message.readInt32LE(12)\n  };\n};\n\nfunction applyCommonQueryOptions(queryOptions, options) {\n  Object.assign(queryOptions, {\n    raw: typeof options.raw === 'boolean' ? options.raw : false,\n    promoteLongs: typeof options.promoteLongs === 'boolean' ? options.promoteLongs : true,\n    promoteValues: typeof options.promoteValues === 'boolean' ? options.promoteValues : true,\n    promoteBuffers: typeof options.promoteBuffers === 'boolean' ? options.promoteBuffers : false,\n    monitoring: typeof options.monitoring === 'boolean' ? options.monitoring : false,\n    fullResult: typeof options.fullResult === 'boolean' ? options.fullResult : false\n  });\n\n  if (typeof options.socketTimeout === 'number') {\n    queryOptions.socketTimeout = options.socketTimeout;\n  }\n\n  if (options.session) {\n    queryOptions.session = options.session;\n  }\n\n  if (typeof options.documentsReturnedIn === 'string') {\n    queryOptions.documentsReturnedIn = options.documentsReturnedIn;\n  }\n\n  return queryOptions;\n}\n\nfunction isSharded(topologyOrServer) {\n  if (topologyOrServer.type === 'mongos') return true;\n  if (topologyOrServer.description && topologyOrServer.description.type === ServerType.Mongos) {\n    return true;\n  }\n\n  // NOTE: This is incredibly inefficient, and should be removed once command construction\n  //       happens based on `Server` not `Topology`.\n  if (topologyOrServer.description && topologyOrServer.description instanceof TopologyDescription) {\n    const servers = Array.from(topologyOrServer.description.servers.values());\n    return servers.some(server => server.type === ServerType.Mongos);\n  }\n\n  return false;\n}\n\nfunction databaseNamespace(ns) {\n  return ns.split('.')[0];\n}\nfunction collectionNamespace(ns) {\n  return ns\n    .split('.')\n    .slice(1)\n    .join('.');\n}\n\nmodule.exports = {\n  getReadPreference,\n  MESSAGE_HEADER_SIZE,\n  COMPRESSION_DETAILS_SIZE,\n  opcodes,\n  parseHeader,\n  applyCommonQueryOptions,\n  isSharded,\n  databaseNamespace,\n  collectionNamespace\n};\n"],"mappings":"AAAA;;AAEA,MAAMA,cAAc,GAAGC,OAAO,CAAC,+BAAD,CAA9B;;AACA,MAAMC,UAAU,GAAGD,OAAO,CAAC,UAAD,CAAP,CAAoBC,UAAvC;;AACA,MAAMC,UAAU,GAAGF,OAAO,CAAC,gBAAD,CAAP,CAA0BE,UAA7C;;AACA,MAAMC,mBAAmB,GAAGH,OAAO,CAAC,8BAAD,CAAP,CAAwCG,mBAApE;;AAEA,MAAMC,mBAAmB,GAAG,EAA5B;AACA,MAAMC,wBAAwB,GAAG,CAAjC,C,CAAoC;AAEpC;AACA;;AACA,IAAIC,OAAO,GAAG;EACZC,QAAQ,EAAE,CADE;EAEZC,SAAS,EAAE,IAFC;EAGZC,SAAS,EAAE,IAHC;EAIZC,QAAQ,EAAE,IAJE;EAKZC,UAAU,EAAE,IALA;EAMZC,SAAS,EAAE,IANC;EAOZC,eAAe,EAAE,IAPL;EAQZC,aAAa,EAAE,IARH;EASZC,MAAM,EAAE;AATI,CAAd;;AAYA,IAAIC,iBAAiB,GAAG,UAASC,GAAT,EAAcC,OAAd,EAAuB;EAC7C;EACA,IAAIC,cAAc,GAAGF,GAAG,CAACE,cAAJ,IAAsB,IAAIpB,cAAJ,CAAmB,SAAnB,CAA3C,CAF6C,CAG7C;;EACA,IAAImB,OAAO,CAACC,cAAZ,EAA4B;IAC1BA,cAAc,GAAGD,OAAO,CAACC,cAAzB;EACD;;EAED,IAAI,OAAOA,cAAP,KAA0B,QAA9B,EAAwC;IACtCA,cAAc,GAAG,IAAIpB,cAAJ,CAAmBoB,cAAnB,CAAjB;EACD;;EAED,IAAI,EAAEA,cAAc,YAAYpB,cAA5B,CAAJ,EAAiD;IAC/C,MAAM,IAAIE,UAAJ,CAAe,mDAAf,CAAN;EACD;;EAED,OAAOkB,cAAP;AACD,CAjBD,C,CAmBA;;;AACA,IAAIC,WAAW,GAAG,UAASC,OAAT,EAAkB;EAClC,OAAO;IACLC,MAAM,EAAED,OAAO,CAACE,WAAR,CAAoB,CAApB,CADH;IAELC,SAAS,EAAEH,OAAO,CAACE,WAAR,CAAoB,CAApB,CAFN;IAGLE,UAAU,EAAEJ,OAAO,CAACE,WAAR,CAAoB,CAApB,CAHP;IAILG,MAAM,EAAEL,OAAO,CAACE,WAAR,CAAoB,EAApB;EAJH,CAAP;AAMD,CAPD;;AASA,SAASI,uBAAT,CAAiCC,YAAjC,EAA+CV,OAA/C,EAAwD;EACtDW,MAAM,CAACC,MAAP,CAAcF,YAAd,EAA4B;IAC1BG,GAAG,EAAE,OAAOb,OAAO,CAACa,GAAf,KAAuB,SAAvB,GAAmCb,OAAO,CAACa,GAA3C,GAAiD,KAD5B;IAE1BC,YAAY,EAAE,OAAOd,OAAO,CAACc,YAAf,KAAgC,SAAhC,GAA4Cd,OAAO,CAACc,YAApD,GAAmE,IAFvD;IAG1BC,aAAa,EAAE,OAAOf,OAAO,CAACe,aAAf,KAAiC,SAAjC,GAA6Cf,OAAO,CAACe,aAArD,GAAqE,IAH1D;IAI1BC,cAAc,EAAE,OAAOhB,OAAO,CAACgB,cAAf,KAAkC,SAAlC,GAA8ChB,OAAO,CAACgB,cAAtD,GAAuE,KAJ7D;IAK1BC,UAAU,EAAE,OAAOjB,OAAO,CAACiB,UAAf,KAA8B,SAA9B,GAA0CjB,OAAO,CAACiB,UAAlD,GAA+D,KALjD;IAM1BC,UAAU,EAAE,OAAOlB,OAAO,CAACkB,UAAf,KAA8B,SAA9B,GAA0ClB,OAAO,CAACkB,UAAlD,GAA+D;EANjD,CAA5B;;EASA,IAAI,OAAOlB,OAAO,CAACmB,aAAf,KAAiC,QAArC,EAA+C;IAC7CT,YAAY,CAACS,aAAb,GAA6BnB,OAAO,CAACmB,aAArC;EACD;;EAED,IAAInB,OAAO,CAACoB,OAAZ,EAAqB;IACnBV,YAAY,CAACU,OAAb,GAAuBpB,OAAO,CAACoB,OAA/B;EACD;;EAED,IAAI,OAAOpB,OAAO,CAACqB,mBAAf,KAAuC,QAA3C,EAAqD;IACnDX,YAAY,CAACW,mBAAb,GAAmCrB,OAAO,CAACqB,mBAA3C;EACD;;EAED,OAAOX,YAAP;AACD;;AAED,SAASY,SAAT,CAAmBC,gBAAnB,EAAqC;EACnC,IAAIA,gBAAgB,CAACC,IAAjB,KAA0B,QAA9B,EAAwC,OAAO,IAAP;;EACxC,IAAID,gBAAgB,CAACE,WAAjB,IAAgCF,gBAAgB,CAACE,WAAjB,CAA6BD,IAA7B,KAAsCxC,UAAU,CAAC0C,MAArF,EAA6F;IAC3F,OAAO,IAAP;EACD,CAJkC,CAMnC;EACA;;;EACA,IAAIH,gBAAgB,CAACE,WAAjB,IAAgCF,gBAAgB,CAACE,WAAjB,YAAwCxC,mBAA5E,EAAiG;IAC/F,MAAM0C,OAAO,GAAGC,KAAK,CAACC,IAAN,CAAWN,gBAAgB,CAACE,WAAjB,CAA6BE,OAA7B,CAAqCG,MAArC,EAAX,CAAhB;IACA,OAAOH,OAAO,CAACI,IAAR,CAAaC,MAAM,IAAIA,MAAM,CAACR,IAAP,KAAgBxC,UAAU,CAAC0C,MAAlD,CAAP;EACD;;EAED,OAAO,KAAP;AACD;;AAED,SAASO,iBAAT,CAA2BC,EAA3B,EAA+B;EAC7B,OAAOA,EAAE,CAACC,KAAH,CAAS,GAAT,EAAc,CAAd,CAAP;AACD;;AACD,SAASC,mBAAT,CAA6BF,EAA7B,EAAiC;EAC/B,OAAOA,EAAE,CACNC,KADI,CACE,GADF,EAEJE,KAFI,CAEE,CAFF,EAGJC,IAHI,CAGC,GAHD,CAAP;AAID;;AAEDC,MAAM,CAACC,OAAP,GAAiB;EACf1C,iBADe;EAEfZ,mBAFe;EAGfC,wBAHe;EAIfC,OAJe;EAKfc,WALe;EAMfO,uBANe;EAOfa,SAPe;EAQfW,iBARe;EASfG;AATe,CAAjB"},"metadata":{},"sourceType":"script"}